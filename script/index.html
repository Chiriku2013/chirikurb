<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chiriku Script Manager</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  .no-select { user-select: none; }
  .script-card { min-width: 300px; max-width: 400px; width: 100%; }
  #toolbar { transform: translateX(-100%); opacity: 0; transition: all 0.3s ease; }
  #toolbar.show { transform: translateX(0); opacity: 1; }
</style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col items-center">

<!-- Toolbar Toggle -->
<button id="toolbarToggle" class="fixed top-4 left-4 bg-blue-600 p-3 rounded-full shadow-lg hover:bg-blue-500">‚ò∞</button>

<!-- Toolbar -->
<div id="toolbar" class="fixed top-0 left-0 h-full w-60 bg-gray-800 p-4 space-y-4 flex flex-col">
  <h2 class="text-xl font-bold mb-2">C√¥ng c·ª•</h2>
  <button id="addScriptBtn" class="w-full bg-green-600 py-2 rounded-lg hover:bg-green-500">Th√™m Script</button>
  <button id="updateScriptBtn" class="w-full bg-yellow-600 py-2 rounded-lg hover:bg-yellow-500 hidden">C·∫≠p nh·∫≠t Script</button>
  <button id="removeScriptBtn" class="w-full bg-red-600 py-2 rounded-lg hover:bg-red-500 hidden">X√≥a Script</button>
</div>

<!-- Password Modal -->
<div id="passwordModal" class="fixed inset-0 bg-black/70 hidden items-center justify-center">
  <div class="bg-gray-800 p-6 rounded-2xl w-80 space-y-4">
    <h2 class="text-xl font-bold text-center">X√°c minh Admin</h2>
    <input id="adminPassword" class="w-full p-2 rounded-lg text-black" type="password" placeholder="Nh·∫≠p m·∫≠t kh·∫©u...">
    <div class="flex justify-end gap-2">
      <button id="cancelPass" class="bg-gray-600 px-3 py-1 rounded-lg hover:bg-gray-500">H·ªßy</button>
      <button id="confirmPass" class="bg-green-600 px-3 py-1 rounded-lg hover:bg-green-500">OK</button>
    </div>
  </div>
</div>

<!-- Add Script Modal -->
<div id="addDialog" class="fixed inset-0 bg-black/70 hidden items-center justify-center">
  <div class="bg-gray-800 p-6 rounded-2xl w-96 space-y-4">
    <h2 class="text-xl font-bold text-center">Th√™m Script</h2>
    <input id="scriptName" class="w-full p-2 rounded-lg text-black" placeholder="T√™n hi·ªÉn th·ªã...">
    <textarea id="scriptCode" class="w-full p-2 rounded-lg text-black" placeholder="D√°n code script Roblox..." rows="5"></textarea>
    <div class="flex justify-end gap-2">
      <button id="cancelAdd" class="bg-gray-600 px-3 py-1 rounded-lg hover:bg-gray-500">H·ªßy</button>
      <button id="confirmAdd" class="bg-green-600 px-3 py-1 rounded-lg hover:bg-green-500">OK</button>
    </div>
  </div>
</div>

<!-- Update Script Modal -->
<div id="updateDialog" class="fixed inset-0 bg-black/70 hidden items-center justify-center">
  <div class="bg-gray-800 p-6 rounded-2xl w-96 space-y-4">
    <h2 class="text-xl font-bold text-center">C·∫≠p nh·∫≠t Script</h2>
    <input id="updateName" class="w-full p-2 rounded-lg text-black" placeholder="T√™n script ƒë√£ c√≥...">
    <textarea id="updateCode" class="w-full p-2 rounded-lg text-black" placeholder="Code m·ªõi..." rows="5"></textarea>
    <div class="flex justify-end gap-2">
      <button id="cancelUpdate" class="bg-gray-600 px-3 py-1 rounded-lg hover:bg-gray-500">H·ªßy</button>
      <button id="confirmUpdate" class="bg-yellow-600 px-3 py-1 rounded-lg hover:bg-yellow-500">L∆∞u</button>
    </div>
  </div>
</div>

<!-- Script Container -->
<div id="scriptContainer" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mt-24 w-full px-4 max-w-7xl"></div>

<script>

function getToken(){
  const junk=["!!","xyz","@@","###","%%%$","123","üòà","()",">>>"];
  const scrambled=["Z2",junk[0],"hwX",junk[2],"1ly",junk[5],"OG","NKV",junk[3],"3FGM","ERt",junk[1],"dWV1","QTc","1cT","lEVm",junk[7],"Q0U","U1R","aVh",junk[4],"pdD","QzW","jVE","eQ==",junk[6]];
  return atob(scrambled.filter(s=>!junk.includes(s)).join(""));
}
function getAdminPass(){
  const junk=["~~","@@@","**","111","::","(x)",":-)",">>","!!"];
  const scrambled=["Y2",junk[0],"hp","c",junk[1],"ml","rdW","Fkb",junk[2],"Wl","uZ","Hpy","ZWFs",junk[3]];
  return atob(scrambled.filter(s=>!junk.includes(s)).join(""));
}

// ===== CONFIG =====
const repoOwner="Chiriku2013", repoName="chirikurb", filePath="script/file.json";
let isAdmin=false;

// ===== TOGGLE TOOLBAR =====
const toolbar=document.getElementById('toolbar');
document.getElementById('toolbarToggle').onclick=()=>toolbar.classList.toggle('show');

// ===== FETCH SCRIPTS =====
async function fetchScripts(){
  try{
    const res=await fetch(`https://raw.githubusercontent.com/${repoOwner}/${repoName}/main/${filePath}?t=${Date.now()}`);
    if(!res.ok) return [];
    return await res.json();
  }catch{return [];}
}

// ===== RENDER SCRIPTS =====
async function renderScripts(){
  const scripts=await fetchScripts();
  const container=document.getElementById('scriptContainer');
  container.innerHTML='';
  if(scripts.length===0){
    container.innerHTML='<p class="col-span-full text-center text-gray-400">Ch∆∞a c√≥ script n√†o</p>';
    return;
  }
  scripts.forEach((s,i)=>{
    const card=document.createElement('div');
    card.className='script-card bg-gray-800 rounded-2xl p-4 shadow-lg relative';
    card.innerHTML=`
      <div class="flex justify-between items-center">
        <h3 class="font-bold text-lg">${s.name||"Unnamed"}</h3>
        <button class="bg-blue-600 hover:bg-blue-500 px-2 py-1 rounded text-sm copyBtn">Sao ch√©p</button>
      </div>
      <pre class="bg-gray-900 p-2 mt-2 rounded-lg text-sm overflow-x-auto no-select">${s.code||"undefined"}</pre>
    `;
    if(isAdmin){
      const checkbox=document.createElement('input');
      checkbox.type='checkbox';
      checkbox.className='absolute top-3 left-3';
      card.prepend(checkbox);
    }
    container.appendChild(card);
  });
  document.querySelectorAll('.copyBtn').forEach((btn,i)=>{
    btn.onclick=()=>{
      navigator.clipboard.writeText(scripts[i].code||"");
      btn.textContent='ƒê√£ sao ch√©p!';
      setTimeout(()=>btn.textContent='Sao ch√©p',1000);
    };
  });
}

// ===== WRITE TO GITHUB =====
async function writeRepo(newData, message){
  const token=getToken();
  const apiUrl=`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filePath}`;
  try{
    const res=await fetch(apiUrl,{ headers:{ Authorization:`token ${token}` }});
    const data=await res.json();
    const sha=data.sha;
    await fetch(apiUrl,{
      method:'PUT',
      headers:{
        Authorization:`token ${token}`,
        'Content-Type':'application/json'
      },
      body: JSON.stringify({ message, content:btoa(JSON.stringify(newData,null,2)), sha })
    });
    alert('‚úÖ Thao t√°c th√†nh c√¥ng!');
  }catch(e){ console.error(e); alert('‚ùå L·ªói khi ghi file!'); }
}

// ===== PASSWORD MODAL =====
const passModal=document.getElementById('passwordModal');
document.getElementById('cancelPass').onclick=()=>passModal.style.display='none';
document.getElementById('confirmPass').onclick=()=>{
  const input=document.getElementById('adminPassword').value.trim();
  passModal.style.display='none';
  if(input===getAdminPass()){
    alert('üîì Admin mode activated!');
    isAdmin=true;
    document.getElementById('removeScriptBtn').classList.remove('hidden');
    document.getElementById('updateScriptBtn').classList.remove('hidden');
    renderScripts();
  } else alert('‚ùå Sai m·∫≠t kh·∫©u!');
};
function showPasswordModal(){ passModal.style.display='flex'; }

// ===== HOLD 3s ADD =====
const addBtn=document.getElementById('addScriptBtn');
let holdTimer=null;
addBtn.addEventListener('touchstart',()=>holdTimer=setTimeout(showPasswordModal,3000));
addBtn.addEventListener('mousedown',()=>holdTimer=setTimeout(showPasswordModal,3000));
addBtn.addEventListener('mouseup',()=>clearTimeout(holdTimer));
addBtn.addEventListener('mouseleave',()=>clearTimeout(holdTimer));
addBtn.addEventListener('touchend',()=>clearTimeout(holdTimer));

// ===== ADD SCRIPT =====
const addDialog=document.getElementById('addDialog');
const confirmAdd=document.getElementById('confirmAdd');
const cancelAdd=document.getElementById('cancelAdd');
const scriptNameInput=document.getElementById('scriptName');
const scriptCodeInput=document.getElementById('scriptCode');

confirmAdd.onclick=async()=>{
  const name=scriptNameInput.value.trim(), code=scriptCodeInput.value.trim();
  if(!name||!code)return alert('‚ùå Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß!');
  const scripts=await fetchScripts();
  scripts.push({name, code});
  await writeRepo(scripts,'Add script '+name);
  addDialog.style.display='none';
  scriptNameInput.value=''; scriptCodeInput.value='';
  renderScripts();
};
cancelAdd.onclick=()=>addDialog.style.display='none';
document.getElementById('addScriptBtn').onclick=()=>{ if(isAdmin) addDialog.style.display='flex'; };

// ===== UPDATE SCRIPT =====
const updateDialog=document.getElementById('updateDialog');
const confirmUpdate=document.getElementById('confirmUpdate');
const cancelUpdate=document.getElementById('cancelUpdate');
const updateNameInput=document.getElementById('updateName');
const updateCodeInput=document.getElementById('updateCode');

document.getElementById('updateScriptBtn').onclick=()=>{ if(isAdmin) updateDialog.style.display='flex'; };

confirmUpdate.onclick=async()=>{
  const name=updateNameInput.value.trim(), code=updateCodeInput.value.trim();
  if(!name||!code)return alert('‚ùå Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß!');
  const scripts=await fetchScripts();
  const idx=scripts.findIndex(s=>s.name===name);
  if(idx===-1)return alert('‚ùå Kh√¥ng t√¨m th·∫•y script!');
  scripts[idx].code=code;
  await writeRepo(scripts,'Update script '+name);
  updateDialog.style.display='none';
  updateNameInput.value=''; updateCodeInput.value='';
  renderScripts();
};
cancelUpdate.onclick=()=>updateDialog.style.display='none';

// ===== REMOVE SCRIPT =====
document.getElementById('removeScriptBtn').onclick=async()=>{
  if(!isAdmin) return;
  const checkboxes=document.querySelectorAll('#scriptContainer input[type=checkbox]:checked');
  if(checkboxes.length===0) return alert('‚ùå Ch·ªçn script ƒë·ªÉ x√≥a!');
  if(!confirm(`X√≥a ${checkboxes.length} script?`)) return;
  const scripts=await fetchScripts();
  const remaining=scripts.filter((s,i)=>!checkboxes[i].checked);
  await writeRepo(remaining,'Remove '+checkboxes.length+' script(s)');
  renderScripts();
};

// ===== INIT =====
renderScripts();
</script>
</body>
</html>
