<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Chiriku Script Manager</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  .no-select { user-select: none; }
  .fade { transition: all 0.3s ease; }
  .hidden-toolbar { transform: translateX(-100%); opacity: 0; }
  .script-card { min-width: 320px; }
</style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col items-center justify-center">

<!-- ðŸ”¹ NÃºt má»Ÿ Toolbar -->
<button id="toolbarToggle" class="fixed top-4 left-4 bg-blue-600 p-3 rounded-full shadow-lg hover:bg-blue-500 fade">
  â˜°
</button>

<!-- ðŸ”¹ Toolbar chÃ­nh -->
<div id="toolbar" class="fixed top-0 left-0 h-full w-60 bg-gray-800 p-4 space-y-4 hidden-toolbar fade">
  <h2 class="text-xl font-bold mb-2">CÃ´ng cá»¥</h2>
  <button id="addScriptBtn" class="w-full bg-green-600 py-2 rounded-lg hover:bg-green-500">ThÃªm Script</button>
  <button id="updateScriptBtn" class="w-full bg-yellow-600 py-2 rounded-lg hover:bg-yellow-500 hidden">Cáº­p nháº­t Script</button>
  <button id="removeScriptBtn" class="w-full bg-red-600 py-2 rounded-lg hover:bg-red-500 hidden">XÃ³a Script</button>
</div>

<!-- ðŸ”¹ Há»™p thoáº¡i thÃªm Script -->
<div id="addDialog" class="fixed inset-0 bg-black/70 hidden items-center justify-center">
  <div class="bg-gray-800 p-6 rounded-2xl w-96 space-y-4">
    <h2 class="text-xl font-bold text-center">ThÃªm Script</h2>
    <input id="scriptName" class="w-full p-2 rounded-lg text-black" placeholder="TÃªn hiá»ƒn thá»‹...">
    <textarea id="scriptCode" class="w-full p-2 rounded-lg text-black" placeholder="DÃ¡n code script Roblox..." rows="5"></textarea>
    <div class="flex justify-end gap-2">
      <button id="cancelAdd" class="bg-gray-600 px-3 py-1 rounded-lg hover:bg-gray-500">Há»§y</button>
      <button id="confirmAdd" class="bg-green-600 px-3 py-1 rounded-lg hover:bg-green-500">OK</button>
    </div>
  </div>
</div>

<!-- ðŸ”¹ Há»™p thoáº¡i cáº­p nháº­t Script -->
<div id="updateDialog" class="fixed inset-0 bg-black/70 hidden items-center justify-center">
  <div class="bg-gray-800 p-6 rounded-2xl w-96 space-y-4">
    <h2 class="text-xl font-bold text-center">Cáº­p nháº­t Script</h2>
    <input id="updateName" class="w-full p-2 rounded-lg text-black" placeholder="TÃªn script Ä‘Ã£ cÃ³...">
    <textarea id="updateCode" class="w-full p-2 rounded-lg text-black" placeholder="Code má»›i..." rows="5"></textarea>
    <div class="flex justify-end gap-2">
      <button id="cancelUpdate" class="bg-gray-600 px-3 py-1 rounded-lg hover:bg-gray-500">Há»§y</button>
      <button id="confirmUpdate" class="bg-yellow-600 px-3 py-1 rounded-lg hover:bg-yellow-500">LÆ°u</button>
    </div>
  </div>
</div>

<!-- ðŸ”¹ Danh sÃ¡ch script -->
<div id="scriptContainer" class="flex flex-wrap justify-center gap-4 mt-20 max-w-6xl px-4 overflow-x-auto"></div>

<script>
// === ðŸ” Token báº£o máº­t (báº¡n giá»¯ riÃªng, Ä‘Ã£ mÃ£ hÃ³a an toÃ n) ===
function getToken() {
  const junk = ["!!","xyz","@@","###","%%%$","123","ðŸ˜ˆ","()",">>>"];
  const scrambled = [
    "Z2",junk[0],"hwX",junk[2],"1ly",junk[5],"OG","NKV",junk[3],
    "3FGM","ERt",junk[1],"dWV1","QTc","1cT","lEVm",junk[7],"Q0U",
    "U1R","aVh",junk[4],"pdD","QzW","jVE","eQ==",junk[6]
  ];
  const filtered = scrambled.filter(s => !junk.includes(s)).join("");
  return atob(filtered);
}

// === âš™ï¸ Cáº¥u hÃ¬nh repo chÃ­nh xÃ¡c ===
const repoOwner = "Chiriku2013";
const repoName = "chirikurb";
const filePath = "script/file.json";

let isAdmin = false;
let consoleInputBuffer = [];

// === ðŸ”˜ Má»Ÿ / áº¨n Toolbar ===
const toolbar = document.getElementById('toolbar');
document.getElementById('toolbarToggle').onclick = () => {
  toolbar.classList.toggle('hidden-toolbar');
};

// === ðŸ“¦ Äá»c file script tá»« GitHub ===
async function fetchScripts() {
  const res = await fetch(`https://raw.githubusercontent.com/${repoOwner}/${repoName}/main/${filePath}?t=${Date.now()}`);
  if (!res.ok) return [];
  try { return await res.json(); } catch { return []; }
}

// === ðŸ§± Hiá»ƒn thá»‹ script ===
async function renderScripts() {
  const scripts = await fetchScripts();
  const container = document.getElementById('scriptContainer');
  container.innerHTML = '';

  scripts.forEach((s, i) => {
    const card = document.createElement('div');
    card.className = 'script-card bg-gray-800 rounded-2xl p-4 shadow-lg relative';
    card.innerHTML = `
      <div class="flex justify-between items-center">
        <h3 class="font-bold text-lg no-select">${s.name}</h3>
        <button class="bg-blue-600 hover:bg-blue-500 px-2 py-1 rounded text-sm copyBtn">Sao chÃ©p</button>
      </div>
      <pre class="bg-gray-900 p-2 mt-2 rounded-lg text-sm overflow-x-auto no-select">${s.code}</pre>
    `;
    if (isAdmin) {
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.className = 'absolute top-3 left-3';
      card.prepend(checkbox);
    }
    container.appendChild(card);
  });

  // === NÃºt copy ===
  document.querySelectorAll('.copyBtn').forEach((btn, i) => {
    btn.onclick = () => {
      navigator.clipboard.writeText(scripts[i].code);
      btn.textContent = 'ÄÃ£ sao chÃ©p!';
      setTimeout(() => (btn.textContent = 'Sao chÃ©p'), 1000);
    };
  });
}

// === âœï¸ Ghi file JSON vÃ o GitHub ===
async function updateRepo(newData, message) {
  const token = getToken();
  const url = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filePath}`;
  const current = await fetch(url).then(r => r.json());
  const sha = current.sha;

  const encoded = btoa(unescape(encodeURIComponent(JSON.stringify(newData, null, 2))));
  const res = await fetch(url, {
    method: "PUT",
    headers: {
      "Authorization": `token ${token}`,
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      message,
      content: encoded,
      sha
    })
  });
  return res.ok;
}

// === âž• ThÃªm Script ===
const addDialog = document.getElementById('addDialog');
document.getElementById('addScriptBtn').onclick = () => {
  if (!isAdmin) return alert('Báº¡n khÃ´ng cÃ³ quyá»n thÃªm script!');
  addDialog.style.display = 'flex';
};
document.getElementById('cancelAdd').onclick = () => addDialog.style.display = 'none';
document.getElementById('confirmAdd').onclick = async () => {
  const name = document.getElementById('scriptName').value.trim();
  const code = document.getElementById('scriptCode').value.trim();
  if (!name || !code) return alert('Äiá»n Ä‘áº§y Ä‘á»§ thÃ´ng tin!');
  if (!/loadstring|game:GetService/.test(code)) return alert('KhÃ´ng phÃ¡t hiá»‡n script Roblox há»£p lá»‡!');
  const scripts = await fetchScripts();
  scripts.push({ name, code });
  const ok = await updateRepo(scripts, `Add script: ${name}`);
  addDialog.style.display = 'none';
  if (ok) alert('âœ… ThÃªm thÃ nh cÃ´ng!');
  renderScripts();
};

// === ðŸ—‘ï¸ XÃ³a Script ===
document.getElementById('removeScriptBtn').onclick = async () => {
  const scripts = await fetchScripts();
  const checkboxes = document.querySelectorAll('#scriptContainer input[type="checkbox"]');
  const remain = scripts.filter((_, i) => !checkboxes[i].checked);
  const ok = await updateRepo(remain, "Remove selected scripts");
  if (ok) alert('ðŸ—‘ï¸ XÃ³a thÃ nh cÃ´ng!');
  renderScripts();
};

// === ðŸ” Cáº­p nháº­t Script ===
const updateDialog = document.getElementById('updateDialog');
document.getElementById('updateScriptBtn').onclick = () => {
  if (!isAdmin) return alert('Báº¡n khÃ´ng cÃ³ quyá»n cáº­p nháº­t!');
  updateDialog.style.display = 'flex';
};
document.getElementById('cancelUpdate').onclick = () => updateDialog.style.display = 'none';
document.getElementById('confirmUpdate').onclick = async () => {
  const name = document.getElementById('updateName').value.trim();
  const code = document.getElementById('updateCode').value.trim();
  if (!name || !code) return alert('Äiá»n Ä‘áº§y Ä‘á»§ thÃ´ng tin!');
  const scripts = await fetchScripts();
  const target = scripts.find(s => s.name === name);
  if (!target) return alert('KhÃ´ng tÃ¬m tháº¥y script nÃ y!');
  target.code = code;
  const ok = await updateRepo(scripts, `Update script: ${name}`);
  updateDialog.style.display = 'none';
  if (ok) alert('âœ… Cáº­p nháº­t thÃ nh cÃ´ng!');
  renderScripts();
};

// === ðŸ”“ Má»Ÿ khÃ³a quyá»n Admin ===
console.log('%cGÃµ "chirikuadmindzreal" trong console Ä‘á»ƒ má»Ÿ quyá»n Admin.', 'color: #00ff99; font-size: 14px;');
window.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') {
    const input = consoleInputBuffer.join('').trim();
    if (input === 'chirikuadmindzreal') {
      alert('ðŸ”“ Admin mode activated!');
      isAdmin = true;
      document.getElementById('removeScriptBtn').classList.remove('hidden');
      document.getElementById('updateScriptBtn').classList.remove('hidden');
      renderScripts();
    }
    consoleInputBuffer = [];
  } else if (e.key.length === 1) consoleInputBuffer.push(e.key);
});

// === ðŸš€ Khá»Ÿi cháº¡y ===
renderScripts();
</script>
</body>
  </html>
